@page
@model GlobalPaymentFraudDetection.Pages.Alerts.IndexModel
@{
    ViewData["Title"] = "Fraud Alerts";
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <div class="page-header d-flex justify-content-between align-items-center">
                <div>
                    <h1>Fraud Alerts</h1>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/Dashboard">Dashboard</a></li>
                            <li class="breadcrumb-item active">Alerts</li>
                        </ol>
                    </nav>
                </div>
                <div class="d-flex gap-2">
                    <button class="btn btn-outline-danger" id="bulkResolve" style="display: none;">
                        <i class="bi bi-check-circle"></i> Bulk Resolve
                    </button>
                    <button class="btn btn-primary" onclick="location.reload()">
                        <i class="bi bi-arrow-clockwise"></i> Refresh
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4 g-3">
        <div class="col-lg-3 col-md-6 fade-in">
            <div class="stat-card stat-card-danger">
                <h5 class="card-title">Critical Alerts</h5>
                <h2>3</h2>
                <p class="card-text">Requires immediate attention</p>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 fade-in" style="animation-delay: 0.1s;">
            <div class="stat-card stat-card-warning">
                <h5 class="card-title">High Priority</h5>
                <h2>8</h2>
                <p class="card-text">Review within 1 hour</p>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 fade-in" style="animation-delay: 0.2s;">
            <div class="stat-card stat-card-info">
                <h5 class="card-title">Investigating</h5>
                <h2>12</h2>
                <p class="card-text">Under review</p>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 fade-in" style="animation-delay: 0.3s;">
            <div class="stat-card stat-card-success">
                <h5 class="card-title">Resolved Today</h5>
                <h2>45</h2>
                <p class="card-text">Successfully handled</p>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-funnel"></i> Alert Filters</h5>
                </div>
                <div class="card-body">
                    <form class="row g-3" id="filterForm">
                        <div class="col-md-3">
                            <label class="form-label">Severity</label>
                            <select class="form-select" name="severity" id="severityFilter">
                                <option value="">All Severities</option>
                                <option value="CRITICAL">Critical</option>
                                <option value="HIGH">High</option>
                                <option value="MEDIUM">Medium</option>
                                <option value="LOW">Low</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Status</label>
                            <select class="form-select" name="status" id="statusFilter">
                                <option value="">All Statuses</option>
                                <option value="PENDING">Pending</option>
                                <option value="INVESTIGATING">Investigating</option>
                                <option value="RESOLVED">Resolved</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Alert Type</label>
                            <select class="form-select" name="type" id="typeFilter">
                                <option value="">All Types</option>
                                <option value="HIGH_RISK_TRANSACTION">High Risk Transaction</option>
                                <option value="UNUSUAL_VELOCITY">Unusual Velocity</option>
                                <option value="GEO_ANOMALY">Geographic Anomaly</option>
                                <option value="BLACKLIST_MATCH">Blacklist Match</option>
                            </select>
                        </div>
                        <div class="col-md-3 d-flex align-items-end gap-2">
                            <button type="button" class="btn btn-primary flex-grow-1" onclick="applyFilters()">
                                <i class="bi bi-check"></i> Apply
                            </button>
                            <button type="button" class="btn btn-outline-secondary" onclick="clearFilters()">
                                <i class="bi bi-x"></i> Clear
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="bi bi-bell"></i> Active Alerts</h5>
                    <span class="text-muted"><small id="alertCount">Showing 23 alerts</small></span>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="alertsTable">
                            <thead>
                                <tr>
                                    <th width="40">
                                        <input type="checkbox" class="form-check-input" id="selectAll">
                                    </th>
                                    <th>Alert ID</th>
                                    <th>Type</th>
                                    <th>Severity</th>
                                    <th>Transaction ID</th>
                                    <th>Amount</th>
                                    <th>Fraud Score</th>
                                    <th>Created</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="alert-row" data-severity="CRITICAL" data-status="PENDING">
                                    <td><input type="checkbox" class="form-check-input alert-checkbox"></td>
                                    <td><code>ALT-001</code></td>
                                    <td><span class="badge bg-danger">High Risk Transaction</span></td>
                                    <td><span class="badge bg-danger">CRITICAL</span></td>
                                    <td><code>TX-abc123</code></td>
                                    <td><strong>$2,499.99</strong></td>
                                    <td><span class="badge bg-danger">95.3%</span></td>
                                    <td>2 min ago</td>
                                    <td><span class="badge bg-warning">PENDING</span></td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-primary" onclick="investigateAlert('ALT-001')">
                                                <i class="bi bi-search"></i>
                                            </button>
                                            <button class="btn btn-outline-success" onclick="resolveAlert('ALT-001')">
                                                <i class="bi bi-check"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="alert-row" data-severity="HIGH" data-status="INVESTIGATING">
                                    <td><input type="checkbox" class="form-check-input alert-checkbox"></td>
                                    <td><code>ALT-002</code></td>
                                    <td><span class="badge bg-warning">Unusual Velocity</span></td>
                                    <td><span class="badge bg-warning">HIGH</span></td>
                                    <td><code>TX-def456</code></td>
                                    <td><strong>$149.99</strong></td>
                                    <td><span class="badge bg-warning">72.8%</span></td>
                                    <td>15 min ago</td>
                                    <td><span class="badge bg-info">INVESTIGATING</span></td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-primary" onclick="investigateAlert('ALT-002')">
                                                <i class="bi bi-search"></i>
                                            </button>
                                            <button class="btn btn-outline-success" onclick="resolveAlert('ALT-002')">
                                                <i class="bi bi-check"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="alert-row" data-severity="CRITICAL" data-status="PENDING">
                                    <td><input type="checkbox" class="form-check-input alert-checkbox"></td>
                                    <td><code>ALT-003</code></td>
                                    <td><span class="badge bg-danger">Blacklist Match</span></td>
                                    <td><span class="badge bg-danger">CRITICAL</span></td>
                                    <td><code>TX-ghi789</code></td>
                                    <td><strong>$890.00</strong></td>
                                    <td><span class="badge bg-danger">98.1%</span></td>
                                    <td>28 min ago</td>
                                    <td><span class="badge bg-warning">PENDING</span></td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-primary" onclick="investigateAlert('ALT-003')">
                                                <i class="bi bi-search"></i>
                                            </button>
                                            <button class="btn btn-outline-success" onclick="resolveAlert('ALT-003')">
                                                <i class="bi bi-check"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="alert-row" data-severity="MEDIUM" data-status="PENDING">
                                    <td><input type="checkbox" class="form-check-input alert-checkbox"></td>
                                    <td><code>ALT-004</code></td>
                                    <td><span class="badge bg-info">Geographic Anomaly</span></td>
                                    <td><span class="badge bg-info">MEDIUM</span></td>
                                    <td><code>TX-jkl012</code></td>
                                    <td><strong>$325.50</strong></td>
                                    <td><span class="badge bg-warning">65.4%</span></td>
                                    <td>1 hour ago</td>
                                    <td><span class="badge bg-warning">PENDING</span></td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-primary" onclick="investigateAlert('ALT-004')">
                                                <i class="bi bi-search"></i>
                                            </button>
                                            <button class="btn btn-outline-success" onclick="resolveAlert('ALT-004')">
                                                <i class="bi bi-check"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function investigateAlert(alertId) {
            showToast('Investigating alert: ' + alertId, 'info');
            setTimeout(() => {
                const row = Array.from(document.querySelectorAll('code')).find(el => el.textContent === alertId)?.closest('tr');
                if (row) {
                    row.querySelector('.badge.bg-warning').textContent = 'INVESTIGATING';
                    row.querySelector('.badge.bg-warning').classList.remove('bg-warning');
                    row.querySelector('.badge').classList.add('bg-info');
                }
            }, 500);
        }

        function resolveAlert(alertId) {
            if (confirm('Are you sure you want to resolve this alert?')) {
                showToast('Alert resolved: ' + alertId, 'success');
                setTimeout(() => {
                    const row = Array.from(document.querySelectorAll('code')).find(el => el.textContent === alertId)?.closest('tr');
                    if (row) {
                        row.style.opacity = '0.5';
                        row.querySelector('.badge.bg-warning, .badge.bg-info').textContent = 'RESOLVED';
                        row.querySelector('.badge.bg-warning, .badge.bg-info').className = 'badge bg-success';
                    }
                }, 500);
            }
        }

        function applyFilters() {
            const severity = document.getElementById('severityFilter').value;
            const status = document.getElementById('statusFilter').value;
            const type = document.getElementById('typeFilter').value;

            const rows = document.querySelectorAll('.alert-row');
            let visibleCount = 0;

            rows.forEach(row => {
                const matchSeverity = !severity || row.dataset.severity === severity;
                const matchStatus = !status || row.dataset.status === status;

                if (matchSeverity && matchStatus) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });

            document.getElementById('alertCount').textContent = `Showing ${visibleCount} alerts`;
            showToast(`Filter applied: ${visibleCount} alerts found`, 'info');
        }

        function clearFilters() {
            document.getElementById('filterForm').reset();
            document.querySelectorAll('.alert-row').forEach(row => row.style.display = '');
            document.getElementById('alertCount').textContent = 'Showing all alerts';
            showToast('Filters cleared', 'info');
        }

        document.getElementById('selectAll').addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('.alert-checkbox');
            checkboxes.forEach(cb => cb.checked = this.checked);
            updateBulkActions();
        });

        document.querySelectorAll('.alert-checkbox').forEach(cb => {
            cb.addEventListener('change', updateBulkActions);
        });

        function updateBulkActions() {
            const checked = document.querySelectorAll('.alert-checkbox:checked').length;
            document.getElementById('bulkResolve').style.display = checked > 0 ? 'block' : 'none';
        }

        document.getElementById('bulkResolve').addEventListener('click', function() {
            const checked = document.querySelectorAll('.alert-checkbox:checked');
            if (confirm(`Resolve ${checked.length} selected alerts?`)) {
                checked.forEach(cb => {
                    const row = cb.closest('tr');
                    row.style.opacity = '0.5';
                });
                showToast(`${checked.length} alerts marked as resolved`, 'success');
            }
        });
    </script>
}
